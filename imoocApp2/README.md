# é¡¹ç›®ç‰ˆæœ¬

å› ä¸ºreact-nativeçš„é¡¹ç›®å¯¹ç‰ˆæœ¬çš„è¦æ±‚å¾ˆä¸¥æ ¼, ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å…¼å®¹æ€§å¯èƒ½ä¼šå­˜åœ¨é—®é¢˜, æ‰€ä»¥æˆ‘ä»¬åœ¨è¿™ä¸ªé¡¹ç›®ä¸­, å°†ç‰ˆæœ¬é”å®šåˆ°@0.22.0ç‰ˆæœ¬

```
sudo npm i react-native@0.22.0 -g
```

åŒæ—¶éœ€è¦æ³¨æ„çš„æ˜¯, åœ¨å®‰è£…rnçš„è¿‡ç¨‹ä¸­, å› ä¸ºéœ€è¦å¼•å…¥facebookçš„ä¸€äº›ä¾èµ–åŒ…ä¹‹ç±», å¾ˆæœ‰å¯èƒ½ä¼šé‡åˆ°ä¾èµ–å®‰è£…ç‰¹åˆ«ä¹…çš„é—®é¢˜, ç›´åˆ°å®‰è£…ä¸äº†, è¿™ä¸ªæ—¶å€™éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ä¸‹è½½ä¾èµ–, å¹¶æŠŠæ²¡æ³•å®‰è£…çš„ä¾èµ–åŒ…æ›¿æ¢æ‰

å½“ç„¶, è¿™ä¸ªä¾èµ–éœ€è¦åœ¨ç½‘ä¸Šæ‰¾ä¸€ä¸‹åˆ«äººé€šè¿‡ç¿»å¢™æ‹¿åˆ°çš„ä¾èµ–åŒ…

æœ€å¥½çš„åŠæ³•è¿˜æ˜¯æä¸ªvpn, è‡ªå·±ç¿»å¢™, å°±çœå»äº†å¾ˆå¤šä¾èµ–çš„é—®é¢˜, è¿™ç§é—®é¢˜åœ¨0.45åæ˜¯éå¸¸å‡¸æ˜¾çš„

åŒæ—¶, æˆ‘ä»¬ä½¿ç”¨vpnçš„åŒå­¦ä¹Ÿéœ€è¦æ³¨æ„ä¸€ä¸‹, å› ä¸ºvpnä¼šåœ¨ç”µè„‘ä¸Šäº§ç”Ÿä¸€ä¸ªç½‘ç»œçš„ä»£ç†, ä½†æ˜¯å› ä¸ºæœ‰è¿™ç§ä»£ç†æœºåˆ¶çš„å­˜åœ¨, ä¼šå¯¼è‡´æˆ‘ä»¬çš„react-nativeé¡¹ç›®   æ²¡!!! æ³•!!! è¿!!! è¡Œ!!!

è§£å†³åŠæ³•å°±æ˜¯, å…¨å±€å®‰è£…rnçš„æ—¶å€™, å¼€å¯å…¨å±€ä»£ç†, åœ¨å®‰è£…å®Œæ¯•å, å†å…³æ‰å³å¯è§£å†³æ­¤é—®é¢˜


# é¡¹ç›®æ‰€éœ€çš„ä¾èµ–

> react-native-vector-icons

ç”¨äºå¼•å…¥é¡µé¢ä¸­çš„iconå›¾æ ‡

> rnpm

ä¸“é—¨å¼€å‘å‡ºæ¥ç”¨äºreact-nativeçš„åŠŸèƒ½, ç”¨äºå°†å¼•å…¥åˆ°react-nativeä¸­çš„ç±»åº“è¿›è¡ŒåŠ è½½

å®‰è£…æ–¹æ³•:

```
yarn add react-native-vector-icons
sudo npm i rnpm -g
```

ä½¿ç”¨rnpmæ¥è¿æ¥æˆ‘ä»¬æ‰€å®‰è£…çš„ç±»åº“
```
rnpm link react-native-vector-icons
```

è¿æ¥æˆåŠŸä¹‹å, å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨è¿™ä¸ªç±»åº“äº†

éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬ä½¿ç”¨expoçš„æ—¶å€™æ˜¯æ²¡æ³•ç›´æ¥ä½¿ç”¨linkçš„, æ‰€ä»¥å¯¹äºlinkåœ¨expoä¸­çš„ç”¨æ³•è¿˜éœ€ç ”ç©¶

# æ³¨æ„ç‚¹

- 1.listViewåˆ—è¡¨è§†å›¾

å½“æˆ‘ä»¬ä½¿ç”¨`ListView`(åˆ—è¡¨è§†å›¾)çš„æ—¶å€™, å› ä¸ºéœ€è¦å¼•å…¥`dataSource`å’Œ`renderRow`åˆ†åˆ«ä½œä¸ºæ•°æ®æºå’Œæ¸²æŸ“æ¨¡æ¿çš„æ—¶å€™, æ­¤æ—¶å°±æ— æ³•å°†stateä¸­çš„å†…å®¹æ¸²æŸ“åˆ°åˆ—è¡¨è§†å›¾ä¸­äº†

å¦å¤–éœ€è¦é¢å¤–æ³¨æ„çš„æ˜¯`dataSource`çš„ç”¨æ³•

```
// dsä½œä¸ºåˆ—è¡¨è§†å›¾çš„æ•°æ®å¯¹è±¡, æ§åˆ¶åˆ—è¡¨çš„æ”¹å˜
const ds = new ListView.DataSource({rowHasChanged: (r1, r2) => r1 !== r2});
this.state = {
    dataSource: ds.cloneWithRows([
        {
            "id":"520000197903055285",
            "thumb":"http://dummyimage.com/600x300/acc669)",
            "video":"http://pcad.video.baidu.com/2c186861490224ba1bab125ee9657c91.mp4?_=1522150394539"
        }
        ,
        {
            "id":"320000198304143686",
            "thumb":"http://dummyimage.com/600x300/907bb5)",
            "video":"http://pcad.video.baidu.com/2c186861490224ba1bab125ee9657c91.mp4?_=1522150394539"
        }
        ,
        {
            "id":"320000201705039032",
            "thumb":"http://dummyimage.com/600x300/b35020)",
            "video":"http://pcad.video.baidu.com/2c186861490224ba1bab125ee9657c91.mp4?_=1522150394539"
        }
    ]),
};
```

##### é€šè¿‡listViewå®ç°ä¸Šæ‹‰åŠ è½½æ›´å¤š

åœ¨listViewä¸Šå¢åŠ å±æ€§onEndReached,å¹¶å®šä¹‰ä¸€ä¸ªç›¸åº”çš„æ–¹æ³•

onEndReachedè¡¨ç¤ºè§¦åº•æ‰€å¯¹åº”å‘ç”Ÿçš„è§¦åº•äº‹ä»¶

æˆ‘ä»¬å®šä¹‰åœ¨è§¦åº•ä¹‹å, è°ƒç”¨ä¸€ä¸ª_fetchMoreDataäº‹ä»¶, å½“æœ‰æ›´å¤šæ•°æ®, ä¸”æ•°æ®ä¸æ˜¯åœ¨åŠ è½½ä¸­çŠ¶æ€æ—¶, æˆ‘ä»¬å†æ¬¡è°ƒç”¨getMockDataå»è¯·æ±‚æ›´å¤šçš„æ•°æ®, æ‹¼åˆåˆ°ä¹‹å‰çš„æ•°æ®åˆ—è¡¨ä¸­, å¹¶å®ç°æ¸²æŸ“å³å¯å®ç°å‡ºç±»ä¼¼äºæ•°æ®åŠ è½½æ›´å¤šçš„æ•ˆæœ

åœ¨çœŸå®ç”Ÿäº§ç¯å¢ƒä¸­, æˆ‘ä»¬éœ€è¦åœ¨è¯·æ±‚ä¸­è¯·æ±‚åˆ°æ¯æ¬¡çš„æ•°æ®çš„sizeå’Œpageç­‰æ•°æ®, åœ¨æ¯æ¬¡è¯·æ±‚æ—¶, å°†sizeå’Œpageä¹Ÿä½œä¸ºä¸€ä¸ªçŠ¶æ€å»è¿›è¡Œç®¡ç†, æ¯æ¬¡å¤šè¯·æ±‚æ•°æ®æ—¶, å†…å®¹å¯¹åº”çš„sizeå’Œpageæ ¹æ®éœ€æ±‚è¿›è¡Œå¢åŠ , å¹¶æ³¨æ„åœ¨æ•°æ®æ¯æ¬¡è¿”å›æ—¶, è¿”å›ä¸€ä¸ªtotalçš„å­—æ®µ, è¡¨ç¤ºæ•°æ®æ€»é‡

æ•°æ®æ€»é‡çš„ä½œç”¨æ˜¯, å½“è¯·æ±‚åˆ°çš„æ•°æ®æ•°ç»„é•¿åº¦å°äºæ•°æ®æ€»é‡çš„æ—¶å€™, è¡¨ç¤ºä»ç„¶æ˜¯æœ‰æ•°æ®çš„, æ­¤æ—¶æ‰å¯å†æ¬¡è¯·æ±‚, å¦åˆ™åº”å‘ŠçŸ¥ç”¨æˆ·å·²ç»æ²¡æœ‰æ›´å¤šæ•°æ®

ä¹Ÿå°±æ˜¯ä¸Šé¢å®ç°çš„_hasMoreçš„æ–¹æ³•çš„ä½œç”¨

```
_fetchMoreData() {
    // æœ‰æ›´å¤šæ•°æ®, ä¸”å½“å‰æ²¡æœ‰å¤„äºåŠ è½½çŠ¶æ€æ—¶
    if(!this._hasMore() || this.state.isLoadingTail) {
        return 
    }
    const page = this.state.nextPage
    // console.error(page)
    this._getMockData(page)
    // å› ä¸ºæ˜¯å¼‚æ­¥çš„, ä¸‹é¢è¿™ä¸ªä¸æ˜¯ç¨³å¦¥çš„æ–¹æ¡ˆ
    this.setState({
        nextPage: page + 1
    })
}
```

å¦å¤–éœ€è¦æ³¨æ„ä¸‹å¯¹äºè¯·æ±‚åˆ°çš„æ•°æ®çš„å¤„ç†, è¿™é‡Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªitemsçš„ç©ºæ•°ç»„å¯¹è¯·æ±‚åˆ°çš„æ•°æ®è¿›è¡Œä¿å­˜, æ¸²æŸ“å†…å®¹ä»¥itemsè¿™ä¸ªstateçš„çŠ¶æ€æ•°æ®ä¸ºå‡†

```
f (response.success) {
    // console.error(response.total)
    // åŠ è½½å¤ªå¿«çœ‹ä¸åˆ°åŠ è½½æ•ˆæœ, æ‰€ä»¥åŠ ä¸€ä¸ªå»¶æ—¶
    let time = 0
    if(page !== 0) {
        time = 2000
    }
    setTimeout(() => {
        let data
        if (page !== 0) {
            data = this.state.items.concat(response.data)
        } else {
            data = response.data
        }
        this.setState({
            items: data,
            isLoadingTail: false,
            isRefreshing: false,
            total: response.total
        }, () => {
            this.setState({
                dataSource: this.state.dataSource.cloneWithRows(this.state.items),
            })
        })
    }, time);
}
```

æ³¨æ„è¿™ä¸ªitemsçš„å¤„ç†, å½“pageä¸ç­‰äº0, ä¹Ÿå°±æ˜¯ä¸æ˜¯ç¬¬ä¸€æ¬¡åŠ è½½çš„æ—¶å€™, æ‰å¯¹pageè¿›è¡Œconcat, å› ä¸ºè€ƒè™‘åˆ°ä¸Šæ‹‰åˆ·æ–°çš„æƒ…å†µ, åˆ·æ–°æ˜¯æ•°æ®æ˜¯è¦†ç›–çš„,setStateæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„å¤„ç†è¿‡ç¨‹, æˆ‘ä»¬å°†items setStateä¹‹å, å°±å¯ä»¥åœ¨å›è°ƒä¸­å»ä½¿ç”¨è¿™ä¸ªä¿å­˜å¥½çš„itemsçš„å€¼äº†

å¦å¤–ä¸€ç‚¹çš„ä¼˜åŒ–æ˜¯, ç›®å‰æˆ‘ä»¬åŠ è½½çš„æ—¶å€™æ˜¯æ²¡æœ‰ä»»ä½•çš„é¢å¤–æç¤ºçš„, è¿™æ ·å…¶å®ç»™åˆ°ç”¨æˆ·çš„æ„ŸçŸ¥å…¶å®æ˜¯ä¸å¥½çš„, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨renderFooteræ¥å¯¹é¡µé¢çš„åº•éƒ¨è¿›è¡Œæ¸²æŸ“

```
_renderFooter() {
    if(!this._hasMore()) {
        return (
            <View style={{textAlign: 'center'}}><Text>æ²¡æœ‰æ›´å¤šäº†~</Text></View>
        )
    } else if(this.state.total !== 0) {
        return <ActivityIndicator/>
    }
}
```

å½“å·²ç»æ²¡æœ‰æ›´å¤šæ•°æ®æ—¶, æ˜¾ç¤ºçš„æ˜¯æ²¡æœ‰æ›´å¤šçš„æç¤º

å½“è¿˜æœ‰æ•°æ®åœ¨åŠ è½½çš„æ—¶å€™æ˜¾ç¤ºActivityIndicatorè¿™ä¸ªç»„ä»¶, è¿™ä¸ªç»„ä»¶ç”¨äºæ˜¾ç¤ºä¸€ä¸ªåœ†å½¢çš„loadingæç¤ºç¬¦å·, æç¤ºç”¨æˆ·æ­£åœ¨åŠ è½½ä¸­

ç›¸å…³å‚æ•° 

> onEndReachedThreshold  ä¼ å…¥æ•°å­—, è¡¨ç¤ºè§¦åº•çš„èŒƒå›´

> showsVerticalScrollIndicator ä¼ å…¥å¸ƒå°”å€¼, è¡¨ç¤ºå‚ç›´æ»šåŠ¨æ¡æ˜¯å¦æ˜¾ç¤º

##### é€šè¿‡listViewå®ç°ä¸‹æ‹‰åˆ·æ–°

åœ¨listViewä¸Šæˆ‘ä»¬å¯ä»¥è°ƒç”¨refreshControlæ–¹æ³•, è¡¨ç¤ºä¸‹æ‹‰åˆ·æ–°çš„æ§åˆ¶, åŒæ­¥é…åˆRefreshControlè¿™ä¸ªç»„ä»¶, æ¥å®ç°åˆ·æ–°æ—¶çš„æ˜¾ç¤ºæ•ˆæœ

RefreshControlè¿™ä¸€ç»„ä»¶å¯ä»¥ç”¨åœ¨ScrollViewå’ŒListViewä¸Š, ç”¨äºä¸ºå…¶æ·»åŠ ä¸‹æ‹‰åˆ·æ–°åŠŸèƒ½

```
refreshControl={
    <RefreshControl
        // æ˜¯å¦åœ¨åˆ·æ–°çš„çŠ¶æ€
        refreshing={this.state.isRefreshing}
        // è§†å›¾å¼€å§‹åˆ·æ–°æ—¶è°ƒç”¨
        onRefresh={this._onRefresh.bind(this)}
        // æŒ‡å®šåˆ·æ–°æŒ‡ç¤ºå™¨çš„é¢œè‰²
        tintColor="#ff0000"
        // æŒ‡å®šåˆ·æ–°æŒ‡ç¤ºå™¨ä¸‹é¢æ˜¾ç¤ºçš„æ–‡å­—
        title="Loading..."
        // æŒ‡å®šåˆ·æ–°æŒ‡ç¤ºå™¨çš„é¢œè‰²
        titleColor="#00ff00"
        // æŒ‡å®šè‡³å°‘ä¸€ç§é¢œè‰²ç”¨æ¥ç»˜åˆ¶åˆ·æ–°æŒ‡ç¤ºå™¨
        colors={['#ff0000', '#00ff00', '#0000ff']}
        // æŒ‡å®šåˆ·æ–°æŒ‡ç¤ºå™¨çš„èƒŒæ™¯è‰²
        progressBackgroundColor="#ffff00"
        // æŒ‡å®šåˆ·æ–°æŒ‡ç¤ºå™¨çš„å‚ç›´èµ·å§‹ä½ç½®
        progressViewOffset={10}
    />
}
```



- 2.fetchè¯·æ±‚

é€šè¿‡fetchè¯·æ±‚åˆ°çš„ä¸œè¥¿, å®é™…å¾—åˆ°çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„ç»“æœ, å› æ­¤æˆ‘ä»¬ä¸éœ€è¦å°†è¯·æ±‚åˆ°çš„å†…å®¹è¿›è¡Œå­—ç¬¦ä¸²åŒ–ğŸŒ¹

åŒæ—¶, ä¸çŸ¥é“æ˜¯ä¸æ˜¯å› ä¸ºè¯·æ±‚æ¥å£ç‰¹æ®Šçš„åŸå› , ä½¿ç”¨mockjsçš„æ¥å£è¯·æ±‚åˆ°çš„å†…å®¹å…¶å®æœ€ç»ˆæ˜¯å¤„åœ¨`_bodyInit`è¿™ä¸ªå¯¹è±¡é‡Œé¢, ä¸”æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸².

ç®€å•å®ä¾‹:

```
getMockData() {
    fetch('http://rapapi.org/mockjs/32725/api/creations/?access_token=123')
        .then((response) => {
            this.setState({
                // è¿™é‡Œçœ‹åˆ°è·å–åˆ°çš„å†…å®¹ä¸­å®é™…æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸², éœ€è¦ä½¿ç”¨JSON.parseå¯¹è¯·æ±‚åˆ°çš„å†…å®¹è¿›è¡Œè§£æ
                // æ³¨æ„å“åº”çš„å¯¹è±¡çš„åç§°
                testData: response._bodyInit
            })
        })
        .catch((error) => {
            console.error(error);
        });
}
```

- å¼•å…¥mockjs

åœ¨åˆæœŸé¡¹ç›®ä¸­å› ä¸ºç”¨ä¸åˆ°åå°çš„è¯·æ±‚è¿™äº›, æ‰€ä»¥æˆ‘ä»¬å¼•å…¥mockjsæ¥å¤„ç†è¯·æ±‚åˆ°çš„æ²¡æœ‰ç»è¿‡è§£æçš„mockjså½¢å¼çš„ç»“æœ

æ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦å°†è¯·æ±‚åˆ°çš„å­—ç¬¦ä¸²å¯¹è±¡ç»“æœè¿›è¡Œmockè§£æ, ç„¶åå†è®¾ç½®åˆ°stateä¸­çš„dataSourceä¸­

```
var data = Mock.mock(response)
this.setState({
    dataSource: this.state.dataSource.cloneWithRows(data.data)
})
```

è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯éœ€è¦ä½¿ç”¨åŸç‰ˆçš„dataSourceè°ƒç”¨cloneWithRowsæ¥è¿›è¡Œåˆ¤å®šæ¸²æŸ“, å¦åˆ™ä¼šå‡ºç°é—®é¢˜